<div class="relative flex h-auto min-h-screen w-full flex-col bg-background-dark font-display overflow-x-hidden">
  <header class="flex items-center justify-between border-b border-[#232948] px-4 sm:px-10 py-3">
    <div class="flex items-center gap-4 text-white">
      <div class="size-6 text-primary">
        <svg fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
          <path d="M44 11.2727C44 14.0109 39.8386 16.3957 33.69 17.6364C39.8386 18.877 44 21.2618 44 24C44 26.7382 39.8386 29.123 33.69 30.3636C39.8386 31.6043 44 33.9891 44 36.7273C44 40.7439 35.0457 44 24 44C12.9543 44 4 40.7439 4 36.7273C4 33.9891 8.16144 31.6043 14.31 30.3636C8.16144 29.123 4 26.7382 4 24C4 21.2618 8.16144 18.877 14.31 17.6364C8.16144 16.3957 4 14.0109 4 11.2727C4 7.25611 12.9543 4 24 4C35.0457 4 44 7.25611 44 11.2727Z" fill="currentColor"></path>
        </svg>
      </div>
      <h2 class="text-white text-lg font-bold">Dota 2 AI Drafter</h2>
    </div>
  </header>

  <main class="flex-1 py-10 px-4 max-w-7xl mx-auto w-full">
    <div class="pb-8">
      <h1 class="text-white text-4xl font-black">ตั้งค่าการจำลอง</h1>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

      <div
        class="flex flex-col gap-6 rounded-lg bg-[#1E2227]/50 p-6 border transition-colors duration-300"
        [class.border-radiant-50]="isRadiantLeft()"
        [class.border-dire-50]="!isRadiantLeft()"
        [style.borderColor]="isRadiantLeft() ? 'rgba(86, 164, 66, 0.5)' : 'rgba(197, 50, 35, 0.5)'">

        <h2
          class="text-[22px] font-bold border-b pb-3 transition-colors duration-300 text-white"
          [class.border-radiant-30]="isRadiantLeft()"
          [class.border-dire-30]="!isRadiantLeft()"
          [style.borderColor]="isRadiantLeft() ? 'rgba(86, 164, 66, 0.3)' : 'rgba(197, 50, 35, 0.3)'">
          {{ isRadiantLeft() ? 'ทีม Radiant' : 'ทีม Dire' }}
        </h2>

        <div class="flex flex-col gap-2 min-h-[112px]">
          @for (hero of (isRadiantLeft() ? radiantTeam() : direTeam()); track hero.id) {
            <div (click)="removeHero(hero, isRadiantLeft() ? 'radiant' : 'dire')" class="relative group cursor-pointer flex items-center gap-4 bg-[#232948] p-2 rounded-lg hover:bg-red-900/50 transition-colors">
              <img [src]="hero.imageUrl" class="w-12 h-12 rounded object-cover">
              <span class="text-white font-bold">{{ hero.name }}</span>
              <span class="absolute right-4 text-red-500 opacity-0 group-hover:opacity-100 material-symbols-outlined">close</span>
            </div>
          }

          @if ((isRadiantLeft() ? radiantTeam() : direTeam()).length === 0) {
            <div class="flex flex-col items-center justify-center gap-2 rounded-xl border-2 border-dashed border-[#323b67] py-10">
              <p class="text-white font-bold">ยังไม่ได้เลือกฮีโร่</p>
              <p class="text-white/50 text-sm">เลือกจากรายการด้านล่าง</p>
            </div>
          }
        </div>
      </div>

      <div class="flex flex-col gap-6 rounded-lg bg-[#1E2227]/50 p-6 border border-primary/50">
        <h2 class="text-[22px] font-bold border-b border-primary/30 pb-3 text-white">การตั้งค่าอัลกอริทึม</h2>

        <div class="space-y-6 pt-4">
          <div class="space-y-2">
            <label class="flex justify-between text-base text-white">
              <span><span class="font-bold">W_BASE</span> (Winrate)</span>
              <span class="font-bold text-lg">{{ settings().wBase }}</span>
            </label>
            <input [(ngModel)]="settings().wBase" type="range" min="0" max="100" class="w-full h-2 bg-[#323b67] rounded-lg appearance-none cursor-pointer accent-primary">
          </div>

          <div class="space-y-2">
            <label class="flex justify-between text-base text-white">
              <span><span class="font-bold">W_COUNTER</span> (Counter)</span>
              <span class="font-bold text-lg">{{ settings().wCounter }}</span>
            </label>
            <input [(ngModel)]="settings().wCounter" type="range" min="0" max="100" class="w-full h-2 bg-[#323b67] rounded-lg appearance-none cursor-pointer accent-primary">
          </div>

          <div class="space-y-2">
            <label class="flex justify-between text-base text-white">
              <span><span class="font-bold">W_SYNERGY</span> (Combo)</span>
              <span class="font-bold text-lg">{{ settings().wSynergy }}</span>
            </label>
            <input [(ngModel)]="settings().wSynergy" type="range" min="0" max="100" class="w-full h-2 bg-[#323b67] rounded-lg appearance-none cursor-pointer accent-primary">
          </div>
        </div>

        <div class="mt-auto pt-8 flex flex-col gap-4">
          <!-- Real-time Score Display -->
          <div class="bg-[#232948] rounded-lg p-4 mb-2">
            <div class="flex justify-between items-center mb-2">
              <span class="text-white/70 text-sm">คะแนนปัจจุบัน (Radiant POV)</span>
              <span 
                class="text-xl font-bold"
                [class.text-radiant]="currentScore() > 0"
                [class.text-dire]="currentScore() < 0"
                [class.text-white]="currentScore() === 0">
                {{ currentScore() > 0 ? '+' : '' }}{{ currentScore().toFixed(2) }}
              </span>
            </div>
            <div class="flex items-center gap-2">
              <span class="text-radiant text-sm font-bold">RAD</span>
              <div class="flex-1 h-2 bg-[#1a1f29] rounded-full overflow-hidden">
                <div 
                  class="h-full transition-all duration-300"
                  [class.bg-radiant]="currentScore() >= 0"
                  [class.bg-dire]="currentScore() < 0"
                  [style.width.%]="50 + (currentScore() / 4)"
                  [style.marginLeft.%]="currentScore() < 0 ? 50 + (currentScore() / 4) : 0">
                </div>
              </div>
              <span class="text-dire text-sm font-bold">DIRE</span>
            </div>
            <p class="text-center text-xs text-white/50 mt-2">
              @if (currentScore() > 5) {
                <span class="text-radiant">Radiant ได้เปรียบมาก</span>
              } @else if (currentScore() > 0) {
                <span class="text-radiant">Radiant ได้เปรียบเล็กน้อย</span>
              } @else if (currentScore() < -5) {
                <span class="text-dire">Dire ได้เปรียบมาก</span>
              } @else if (currentScore() < 0) {
                <span class="text-dire">Dire ได้เปรียบเล็กน้อย</span>
              } @else {
                <span>สมดุล</span>
              }
            </p>
          </div>

           <div class="flex justify-center pb-2">
            <button (click)="swapSides()" class="flex items-center justify-center gap-2 px-6 h-10 text-white/70 bg-transparent border border-[#323b67] rounded-full hover:bg-[#232948] hover:text-white transition-colors cursor-pointer text-sm">
              <span class="material-symbols-outlined text-[18px]">swap_horiz</span>
              <span>สลับฝั่ง (Reset & Swap)</span>
            </button>
          </div>

          <button (click)="startSimulation()" class="w-full h-12 rounded-full bg-primary text-black font-bold hover:bg-yellow-300 transition-colors cursor-pointer">
            เริ่มการจำลอง (Run Minimax)
          </button>
          <button (click)="resetDraft()" class="w-full h-12 rounded-full border border-[#323b67] text-white font-bold hover:bg-[#232948] transition-colors cursor-pointer">
            รีเซ็ต
          </button>
        </div>
      </div>

      <div
        class="flex flex-col gap-6 rounded-lg bg-[#1E2227]/50 p-6 border transition-colors duration-300"
        [class.border-dire-50]="isRadiantLeft()"
        [class.border-radiant-50]="!isRadiantLeft()"
        [style.borderColor]="!isRadiantLeft() ? 'rgba(86, 164, 66, 0.5)' : 'rgba(197, 50, 35, 0.5)'">

        <h2
          class="text-[22px] font-bold border-b pb-3 transition-colors duration-300 text-white"
          [class.border-dire-30]="isRadiantLeft()"
          [class.border-radiant-30]="!isRadiantLeft()"
          [style.borderColor]="!isRadiantLeft() ? 'rgba(86, 164, 66, 0.3)' : 'rgba(197, 50, 35, 0.3)'">
          {{ isRadiantLeft() ? 'ทีม Dire' : 'ทีม Radiant' }}
        </h2>

        <div class="flex flex-col gap-2 min-h-[112px]">
           @for (hero of (isRadiantLeft() ? direTeam() : radiantTeam()); track hero.id) {
            <div (click)="removeHero(hero, isRadiantLeft() ? 'dire' : 'radiant')" class="relative group cursor-pointer flex items-center gap-4 bg-[#232948] p-2 rounded-lg hover:bg-red-900/50 transition-colors">
              <img [src]="hero.imageUrl" class="w-12 h-12 rounded object-cover">
              <span class="text-white font-bold">{{ hero.name }}</span>
              <span class="absolute right-4 text-red-500 opacity-0 group-hover:opacity-100 material-symbols-outlined">close</span>
            </div>
          }

          @if ((isRadiantLeft() ? direTeam() : radiantTeam()).length === 0) {
            <div class="flex flex-col items-center justify-center gap-2 rounded-xl border-2 border-dashed border-[#323b67] py-10">
              <p class="text-white font-bold">ยังไม่ได้เลือกฮีโร่</p>
              <p class="text-white/50 text-sm">เลือกจากรายการด้านล่าง</p>
            </div>
          }
        </div>
      </div>

      <div class="lg:col-span-3 mt-8 bg-[#1E2227]/50 rounded-lg p-6 border border-white/10">
         <div class="flex flex-col sm:flex-row gap-4 mb-6">
            <div class="relative flex-grow">
              <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-white/50">search</span>
              <input
                [ngModel]="searchTerm()"
                (ngModelChange)="searchTerm.set($event)"
                type="text"
                class="w-full bg-[#232948] border-none rounded-full h-12 pl-10 pr-4 text-white focus:ring-2 focus:ring-primary/50"
                placeholder="ค้นหาฮีโร่...">
            </div>
            <div class="flex items-center gap-2">
              <button (click)="activeFilter.set('ALL')" [class.bg-[#323b67]]="activeFilter() === 'ALL'" class="px-4 py-2 rounded-full text-white bg-[#232948] hover:bg-[#323b67] cursor-pointer">ทั้งหมด</button>
              <button (click)="activeFilter.set('str')" [class.bg-red-900]="activeFilter() === 'str'" class="px-4 py-2 rounded-full text-white bg-[#232948] hover:bg-[#323b67] cursor-pointer">Strength</button>
              <button (click)="activeFilter.set('agi')" [class.bg-green-900]="activeFilter() === 'agi'" class="px-4 py-2 rounded-full text-white bg-[#232948] hover:bg-[#323b67] cursor-pointer">Agility</button>
              <button (click)="activeFilter.set('int')" [class.bg-blue-900]="activeFilter() === 'int'" class="px-4 py-2 rounded-full text-white bg-[#232948] hover:bg-[#323b67] cursor-pointer">Intelligence</button>
            </div>
          </div>

          <div class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-12 gap-4">
            @for (hero of filteredHeroes(); track hero.id) {
              <div
                (click)="selectHero(hero)"
                [class.opacity-30]="hero.isPicked"
                [class.grayscale]="hero.isPicked"
                [class.cursor-not-allowed]="hero.isPicked"
                class="relative group cursor-pointer transition-transform hover:scale-105">
                <img [src]="hero.imageUrl" [alt]="hero.name" class="w-full h-auto rounded-md shadow-lg group-hover:outline group-hover:outline-primary">
                <div class="absolute bottom-0 left-0 w-full bg-black/70 text-white text-[10px] text-center py-1 opacity-0 group-hover:opacity-100 transition-opacity">
                  {{ hero.name }}
                </div>
              </div>
            }
          </div>
      </div>

    </div>
  </main>
</div>

<p-dialog
  header="แนะนำ Hero"
  [(visible)]="showSuggestionDialog"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '400px' }"
  (onHide)="closeSuggestionDialog()">

  @if (suggestedHero()) {
    <div class="flex flex-col items-center gap-4 py-4">
      <img
        [src]="suggestedHero()!.imageUrl"
        [alt]="suggestedHero()!.name"
        class="w-24 h-24 rounded-lg shadow-lg">

      <div class="text-center">
        <h3 class="text-xl font-bold">{{ suggestedHero()!.name }}</h3>
        <p class="text-sm text-gray-500 mt-1">
          สำหรับทีม {{ isRadiantTurnForSuggestion() ? 'Radiant' : 'Dire' }}
        </p>
        <p class="text-sm mt-2">
          <span class="font-semibold">Score หลังเลือก:</span>
          <span 
            class="font-bold"
            [class.text-radiant]="suggestedHero()!.immediateScore > 0"
            [class.text-dire]="suggestedHero()!.immediateScore < 0"
            [class.text-primary]="suggestedHero()!.immediateScore === 0">
            {{ suggestedHero()!.immediateScore > 0 ? '+' : '' }}{{ suggestedHero()!.immediateScore.toFixed(2) }}
          </span>
        </p>
      </div>
    </div>
  }

  <ng-template pTemplate="footer">
    <div style="display: flex; flex-direction: column; gap: 0.5rem; width: 100%;">
      <p-button
        label="ตกลง เลือก Hero นี้"
        severity="success"
        [style]="{ width: '100%' }"
        (onClick)="acceptSuggestion()">
      </p-button>
      <p-button
        label="เลือกเอง"
        severity="secondary"
        [outlined]="true"
        [style]="{ width: '100%' }"
        (onClick)="closeSuggestionDialog()">
      </p-button>
    </div>
  </ng-template>
</p-dialog>
